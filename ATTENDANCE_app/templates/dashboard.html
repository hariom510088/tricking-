{% extends 'base.html' %}

{% block content %}
<div class="row">
    <!-- Welcome Section -->
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-body">
                <h3>Welcome, {{ user.get_full_name|default:user.username }}!</h3>
                <p class="text-muted">Today is {% now "F j, Y" %}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Attendance Section -->
    <div class="col-md-6">
        <div class="card attendance-card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Today's Attendance</h5>
            </div>
            <div class="card-body text-center">
                {% if today_attendance %}
                    <div class="alert alert-success">
                        <h6>Checked In: {{ today_attendance.check_in|time }}</h6>
                        {% if today_attendance.check_out %}
                            <h6>Checked Out: {{ today_attendance.check_out|time }}</h6>
                            <h6>Hours Worked: {{ today_attendance.hours_worked }}</h6>
                        {% else %}
                            <p>You are currently checked in</p>
                            <a href="{% url 'check_out' %}" class="btn btn-warning">
                                <i class="fas fa-sign-out-alt"></i> Check Out
                            </a>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <p>You haven't checked in today</p>
                        <a href="{% url 'check_in' %}" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Check In
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'attendance_history' %}" class="btn btn-outline-primary">
                        <i class="fas fa-history"></i> Attendance History
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Announcements Section -->
    <div class="col-md-6">
        <div class="card announcement-card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Recent Announcements</h5>
            </div>
            <div class="card-body">
                {% if announcements %}
                    {% for announcement in announcements %}
                        <div class="border-bottom pb-2 mb-2">
                            <h6>{{ announcement.title }}</h6>
                            <p class="small text-muted">{{ announcement.content|truncatewords:20 }}</p>
                            <small class="text-muted">
                                Posted by {{ announcement.created_by.get_full_name }} on 
                                {{ announcement.created_at|date }}
                            </small>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">No announcements yet.</p>
                {% endif %}
            </div>
        </div>

        <!-- This Week's Summary -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">This Week's Summary</h5>
            </div>
            <div class="card-body">
                <p>Days Present: {{ week_attendance.count }}</p>
                <p>Total Hours: {{ week_attendance.aggregate.sum.hours_worked|default:0 }}</p>
            </div>
        </div>
    </div>
</div>
<!-- This Week's Summary -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">This Week's Summary</h5>
    </div>
    <div class="card-body">
        <p>Days Present: {{ week_attendance.count }}</p>
        <p>Total Hours: {{ total_hours }}</p>
    </div>
</div>
{% endblock %}